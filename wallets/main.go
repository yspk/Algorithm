package main

import (
	"fmt"
	"github.com/chenzhijie/go-web3"
	"github.com/ethereum/go-ethereum/common"
	"math/big"
	"sync"
	"time"
)

//var accounts = []string{
//	"0x96541cf64979162dAB00C314222eF580F6EF86aC",
//	"0xb4e7262740c1871B4979747a3799A3C201CB53b5",
//	"0xB66b42F4fBE3ea20d659Af1F468aC044B7991DA6",
//	"0xc3969f2DE876C59650f8c25085c02E7cd139dF73",
//	"0x0E197f713A536330ae15f8880D88dC17c333938f",
//	"0x0769767eBC9ADE8b086fF2a12583a5F5019598fa",
//	"0x63454F272f3e96F8385D96Dff94597C7110431e7",
//	"0xC7F4a14B73FD3944DB0770cA6881E2a98A4077B4",
//	"0xB8aEFBFD062085e594E399aDDcF112bdF0De1aBA",
//	"0xc3ccB76cFdc823CEBEacEb4ba0c2D164C6C96Bb6",
//	"0x6c6115E3D09A005961F3c33BC9cF49dB9505A0ba",
//	"0x1a0aE735B1fd20Df091ac54908975A5cb1dE3c1C",
//	"0xDC4bcc51193bF027A98B2cc45Fc54D71566E376c",
//	"0x9D749BF44D35Aa29e267B1c3e31F0B5B6d596AcF",
//	"0xE8874Ad346F580e3082297c39055557e033e67Aa",
//	"0x4D87C9B84B27f9cB00F767E65D44A2a387422d03",
//	"0x5cc977bE0DDEdD484DBba35e6663fe7BEE578f77",
//	"0x308233d92e7736931023357F7b72f7232E9f81db",
//	"0x27cc02CB39018194259427097a1E93f91210074f",
//	"0x77e9c0e9B9188aDd15D7aE15e539Dd916A80d261",
//	"0xDE1e0879406e6ce1f70C7434a0D80cDA1c839751",
//	"0xC9ec0cF5Bd01303920Fec627A5dc174C90A6b6e0",
//	"0xb11aa71dA2a3E9Bf8B6dC59e75A95025F3B3553d",
//	"0x5Db117c7364f80AB2372BB41479877c6C36ec622",
//	"0xCF4AB9b2f73cCc7ED5584dE13Dcc2e03291b6B36",
//	"0x050fCaba38075401095AeE287d783A0C74718eD4",
//	"0x7c67913D0B5fbB24e58eB52cE24D994F3821bF1D",
//	"0x8E160Bab161eD88188B618999a48C7791fd06b61",
//	"0x87b395A6e6f1d64703a5eD5904fbC8fd5C3B4566",
//	"0x59648EE3aE87Ebe94f367A92e4Cb4715344936eA",
//	"0x0678C0F4FF27cDbe9f6F08dcf768F63a87e2F096",
//	"0x0510C9959eA738887230d1861f4dc00cb706D152",
//	"0x5554957e6BD15A4dD5d797685189D36B1e15c978",
//	"0x075575054d99F38ee263C106c6DABed654920999",
//	"0x99905350dE0f3D40176412D08680418619621CeD",
//	"0x88a03c49eC2d8FEe7A2EAFe3348FEa63BDcc2bE0",
//	"0x00Be2BD4C5dd8E7a3163558E42804D3F346B9578",
//	"0x733f59C0a284dD1C7329d01Db4C5A706c029ffb4",
//	"0x6840759Cce39e2f6aEe8e28600D04D8B3b7bB47a",
//	"0x675544cD3d503cD4dE326766ADA63bd56acC09BF",
//	"0x504bD05865de8Da755cc1EC377204763845b14DB",
//	"0xAd00bE8831AE258AaD0A7069c042205b7676b616",
//	"0x8b05082d432C129693a313A2b25d469B4a398f71",
//	"0x74dC1A181E9d9F109C437cE6280E5eCf9deba2EF",
//	"0x1a4b2735450fE3C056D194417cA8C0fdFdBC9eD5",
//	"0x2C755F901F443aadF34770312C651a690ec52919",
//	"0xFBe911BD430D09f119132A026AA96110e77b6035",
//	"0x4D9Dbb9FcB188b9BC6ef43419122382ECe96B707",
//	"0x31b5a2A69f4E947805C2d4b10830ACdB2f895E49",
//	"0x5411B43B0515Cfc6975775b616283304606D6499",
//	"0x2FdFB593016c8649Deb67b6818491a28A9a33D78",
//	"0x0a057cF491BedF47a7668099BCcF93f751e20D95",
//	"0x01896811FF9c3aE70B67b365835c5AAB2E160BE4",
//	"0xcA11078A403C3bd0F06fF8BEBf09d1Ee49B70c03",
//	"0x7ab45aDA5389DF6f5b046Be9e64ff189Ef05eE49",
//	"0xe7cCc305baC591eb562E795750E1E8b0D0cA8F9F",
//	"0x8CdEb383e1B61d39cCAeDFb82AAa4beD6a953FcB",
//	"0xB21CeeBc37727038CaD043717b126ACD634d6aAA",
//	"0x0422d2Bc0602fD4cCaff0057a8f64D9B813c994b",
//	"0xE0D4B946c517E36a9d0DB26fC990ACFd9F7ccd3E",
//	"0x012A0C30e1C3c80bf885928721a939fB0634B1a2",
//	"0x3e32daDF6A846790564392F1662F76d37e294178",
//	"0x073b4F23FF96d8F76502d35988b3870e3bfd0CDb",
//	"0x71928a9eEa148F259253Db9DBD79B2980DfA1EF5",
//	"0x00BA6E624Ab5b5582809c2e48EfD02937D3A939a",
//	"0x4764834627F301636C4962952Ff7FF728F13A833",
//	"0x1FFB2B35Dc1017348185Ba1ffa6AC415271b3d66",
//	"0x74d3dE5D8e1C66A58df8Fd77719B630B96ef8d76",
//	"0xE5C032711c71EB3F2bE3d21Cf9DfF62577900414",
//	"0x6845E18337ff79fe018AF9c7c3086DEc69E76696",
//	"0xc91eD593FdEfe38884d4c87539CABa5826a9a916",
//	"0x358C6d5375cB3855839fA44bF1fc64739D20146c",
//	"0x168A0f6794Ee86222271E826F1D70bBA39C1687c",
//	"0xA8DEd10ED9bA2EaaAe3c65E96A60425910a283B6",
//	"0x877D6E13dfE9f3d3d793f599b3c7877d2c914d6b",
//	"0x82C618743EC9b64B515d0FfD42253605118aEb97",
//	"0x74Ee689683625354e98Fd23BD0785f761e2adBa0",
//	"0xf56caB60a76B3820f0c65E965cDd81ab07a638eb",
//	"0x7A7FB18cF7c2fD58a98B5320a2837F66C4b19905",
//	"0x1e6E174d36e6d8bfd9024E7571600CD122eb6974",
//	"0x01e4832eF251507FA399A7B8B24faef067EFDDe6",
//	"0x44A7Fedb08B464b930aECdB885D0f387B0C76BE3",
//	"0xC7b11622aC1c42c7740Bd366a3bDc7CC2b911Ba5",
//	"0x9D80dc97F2F4c368D478ec09b2aD568257422D23",
//	"0x4b565FC406C168922DC875a7013434F02e0CA2a7",
//	"0xB80B1831386fd5370d2453b2d366b9F234141bD2",
//	"0x2292a6241B836dB74f22Bfcf55EdBb9EEF8D39eA",
//	"0xB1cC62D1232Eb830275F2d658645Ec3bfc208cA6",
//	"0x666aB05Dd4EC5EC6Ae3C29AD7fA77Da649086ee8",
//	"0x700DB9A730a1D75ACAE433a716bB8aea6F304067",
//	"0x74c465c8e0CA31FEa7307e7deEB03F1392E1200d",
//	"0xB513ED9F618380E5e7D3D1F780bE8435F159C7b7",
//	"0xd5e8b044635d4d8fB371A501845ed21E71e9Cd05",
//	"0x6Ca0731D75d03b29b8e6C9c8B01Bc3a894741b1B",
//	"0xD467138C2761D8C6663f8B805e47903d25634161",
//	"0xFc25FAc621D9E546D6dfE38C31A6Ad77c6e7d1c6",
//	"0x69543df5caef39ab2e27e400bb6b2ceba114322c",
//	"0x21CF6A6437481C113A6028f492d007539c54C387",
//	"0xcC9819af4BD31702fFfcC4D38105796fcb824d3E",
//}

var accounts = []string{
	"0x0678C0F4FF27cDbe9f6F08dcf768F63a87e2F096",
	"0x0510C9959eA738887230d1861f4dc00cb706D152",
	"0x5554957e6BD15A4dD5d797685189D36B1e15c978",
	"0x075575054d99F38ee263C106c6DABed654920999",
	"0x99905350dE0f3D40176412D08680418619621CeD",
	"0x88a03c49eC2d8FEe7A2EAFe3348FEa63BDcc2bE0",
	"0x21CF6A6437481C113A6028f492d007539c54C387",
	"0xcC9819af4BD31702fFfcC4D38105796fcb824d3E",
	"0x69543df5caef39ab2e27e400bb6b2ceba114322c",
	"0xfE636A3896c20d551f80a87cfdaA49C9425d0DC7",
	"0x5ef393da5F69A703c1DbE867851E3bbece277cf3",
	"0x00Be2BD4C5dd8E7a3163558E42804D3F346B9578",
	"0x733f59C0a284dD1C7329d01Db4C5A706c029ffb4",
	"0x6840759Cce39e2f6aEe8e28600D04D8B3b7bB47a",
	"0x675544cD3d503cD4dE326766ADA63bd56acC09BF",
	"0x504bD05865de8Da755cc1EC377204763845b14DB",
	"0xAd00bE8831AE258AaD0A7069c042205b7676b616",
	"0x8b05082d432C129693a313A2b25d469B4a398f71",
	"0x74dC1A181E9d9F109C437cE6280E5eCf9deba2EF",
	"0x1a4b2735450fE3C056D194417cA8C0fdFdBC9eD5",
	"0x2C755F901F443aadF34770312C651a690ec52919",
	"0xFBe911BD430D09f119132A026AA96110e77b6035",
	"0x4D9Dbb9FcB188b9BC6ef43419122382ECe96B707",
	"0x31b5a2A69f4E947805C2d4b10830ACdB2f895E49",
	"0x5411B43B0515Cfc6975775b616283304606D6499",
	"0x2FdFB593016c8649Deb67b6818491a28A9a33D78",
	"0x0a057cF491BedF47a7668099BCcF93f751e20D95",
	"0x01896811FF9c3aE70B67b365835c5AAB2E160BE4",
	"0xcA11078A403C3bd0F06fF8BEBf09d1Ee49B70c03",
	"0x7ab45aDA5389DF6f5b046Be9e64ff189Ef05eE49",
	"0xe7cCc305baC591eb562E795750E1E8b0D0cA8F9F",
	"0x8CdEb383e1B61d39cCAeDFb82AAa4beD6a953FcB",
	"0xB21CeeBc37727038CaD043717b126ACD634d6aAA",
	"0x0422d2Bc0602fD4cCaff0057a8f64D9B813c994b",
	"0xE0D4B946c517E36a9d0DB26fC990ACFd9F7ccd3E",
	"0x012A0C30e1C3c80bf885928721a939fB0634B1a2",
	"0x3e32daDF6A846790564392F1662F76d37e294178",
	"0x073b4F23FF96d8F76502d35988b3870e3bfd0CDb",
	"0x71928a9eEa148F259253Db9DBD79B2980DfA1EF5",
	"0x00BA6E624Ab5b5582809c2e48EfD02937D3A939a",
	"0x4764834627F301636C4962952Ff7FF728F13A833",
	"0x1FFB2B35Dc1017348185Ba1ffa6AC415271b3d66",
	"0x74d3dE5D8e1C66A58df8Fd77719B630B96ef8d76",
	"0xE5C032711c71EB3F2bE3d21Cf9DfF62577900414",
	"0x6845E18337ff79fe018AF9c7c3086DEc69E76696",
	"0xc91eD593FdEfe38884d4c87539CABa5826a9a916",
	"0x358C6d5375cB3855839fA44bF1fc64739D20146c",
	"0x168A0f6794Ee86222271E826F1D70bBA39C1687c",
	"0xA8DEd10ED9bA2EaaAe3c65E96A60425910a283B6",
	"0x877D6E13dfE9f3d3d793f599b3c7877d2c914d6b",
	"0x82C618743EC9b64B515d0FfD42253605118aEb97",
	"0x74Ee689683625354e98Fd23BD0785f761e2adBa0",
	"0xf56caB60a76B3820f0c65E965cDd81ab07a638eb",
	"0x7A7FB18cF7c2fD58a98B5320a2837F66C4b19905",
	"0x1e6E174d36e6d8bfd9024E7571600CD122eb6974",
	"0x01e4832eF251507FA399A7B8B24faef067EFDDe6",
	"0x44A7Fedb08B464b930aECdB885D0f387B0C76BE3",
	"0xC7b11622aC1c42c7740Bd366a3bDc7CC2b911Ba5",
	"0x9D80dc97F2F4c368D478ec09b2aD568257422D23",
	"0x4b565FC406C168922DC875a7013434F02e0CA2a7",
	"0xB80B1831386fd5370d2453b2d366b9F234141bD2",
	"0x2292a6241B836dB74f22Bfcf55EdBb9EEF8D39eA",
	"0xB1cC62D1232Eb830275F2d658645Ec3bfc208cA6",
	"0x666aB05Dd4EC5EC6Ae3C29AD7fA77Da649086ee8",
	"0x700DB9A730a1D75ACAE433a716bB8aea6F304067",
	"0x74c465c8e0CA31FEa7307e7deEB03F1392E1200d",
	"0xB513ED9F618380E5e7D3D1F780bE8435F159C7b7",
	"0xd5e8b044635d4d8fB371A501845ed21E71e9Cd05",
	"0x6Ca0731D75d03b29b8e6C9c8B01Bc3a894741b1B",
	"0xD467138C2761D8C6663f8B805e47903d25634161",
	"0xFc25FAc621D9E546D6dfE38C31A6Ad77c6e7d1c6",
	"0x96541cf64979162dAB00C314222eF580F6EF86aC",
	"0xb4e7262740c1871B4979747a3799A3C201CB53b5",
	"0xB66b42F4fBE3ea20d659Af1F468aC044B7991DA6",
	"0xc3969f2DE876C59650f8c25085c02E7cd139dF73",
	"0x0E197f713A536330ae15f8880D88dC17c333938f",
	"0x0769767eBC9ADE8b086fF2a12583a5F5019598fa",
	"0x63454F272f3e96F8385D96Dff94597C7110431e7",
	"0xC7F4a14B73FD3944DB0770cA6881E2a98A4077B4",
	"0xB8aEFBFD062085e594E399aDDcF112bdF0De1aBA",
	"0xc3ccB76cFdc823CEBEacEb4ba0c2D164C6C96Bb6",
	"0x6c6115E3D09A005961F3c33BC9cF49dB9505A0ba",
	"0x1a0aE735B1fd20Df091ac54908975A5cb1dE3c1C",
	"0xDC4bcc51193bF027A98B2cc45Fc54D71566E376c",
	"0x9D749BF44D35Aa29e267B1c3e31F0B5B6d596AcF",
	"0xE8874Ad346F580e3082297c39055557e033e67Aa",
	"0x4D87C9B84B27f9cB00F767E65D44A2a387422d03",
	"0x5cc977bE0DDEdD484DBba35e6663fe7BEE578f77",
	"0x308233d92e7736931023357F7b72f7232E9f81db",
	"0x27cc02CB39018194259427097a1E93f91210074f",
	"0x77e9c0e9B9188aDd15D7aE15e539Dd916A80d261",
	"0xDE1e0879406e6ce1f70C7434a0D80cDA1c839751",
	"0xC9ec0cF5Bd01303920Fec627A5dc174C90A6b6e0",
	"0xb11aa71dA2a3E9Bf8B6dC59e75A95025F3B3553d",
	"0x5Db117c7364f80AB2372BB41479877c6C36ec622",
	"0xCF4AB9b2f73cCc7ED5584dE13Dcc2e03291b6B36",
	"0x050fCaba38075401095AeE287d783A0C74718eD4",
	"0x7c67913D0B5fbB24e58eB52cE24D994F3821bF1D",
	"0x8E160Bab161eD88188B618999a48C7791fd06b61",
	"0x87b395A6e6f1d64703a5eD5904fbC8fd5C3B4566",
	"0x59648EE3aE87Ebe94f367A92e4Cb4715344936eA",
	"0xe430724374b66248dba17e9d67f61dc20d99e9eb",
	"0x2a9dbe75364db58a5a179a073cfa1873c5d038f9",
	"0x98b531e78c1b9635e90248b2465ce65587a91fef",
	"0x4dcd3937db33ea7e34b5346dc18e5b89b9455b85",
	"0x683e37dd8cad341fcedf542efa3e18aaffde79c5",
}

func main() {
	al := len(accounts)
	fmt.Println("count:", al)
	//httpP, _ := providers.NewHttpProvider("http://127.0.0.1:8545", 5)
	//httpP, _ := providers.NewHttpProvider("http://127.0.0.1:58545", 100)
	w3, err := web3.NewWeb3("http://127.0.0.1:8555")
	if err != nil {
		fmt.Println("init web3 err")
		return
	}
	var total = big.NewInt(0)
	found := make(chan *big.Int, al)
	var pend sync.WaitGroup
	pend.Add(1)
	go func() {
		defer pend.Done()
		var l int
		for {
			if value, ok := <-found; ok {
				l++
				total = new(big.Int).Add(total, value)
			} else {
				break //表示channel已经被关闭，退出循环
			}

			if l == al {
				close(found)
			}
		}
	}()
	height, _ := w3.Eth.GetBlockNumber()
	for k, v := range accounts {
		pend.Add(1)
		go func(k int, ac string) {
			defer pend.Done()
			addr := common.HexToAddress(ac)
			for {
				if count, err := w3.Eth.GetBalance(addr, big.NewInt(int64(height))); err == nil {
					fmt.Println(k, ac, count.String())
					found <- count
					break
				} else {
					fmt.Println(err.Error())
				}
				time.Sleep(time.Second * 10)
			}
		}(k, v)
	}
	pend.Wait()
	//time.Sleep(time.Second*2)
	//close(found)

	fmt.Println("blockNumber:", height)
	fmt.Println("time:", time.Now().Format("2006/01/02 - 15:04:05"))
	fmt.Println("total:", new(big.Int).Div(total, big.NewInt(1e18)).String())
}
